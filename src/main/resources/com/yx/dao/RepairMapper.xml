<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yx.dao.RepairMapper">

        <!-- 通用查询映射结果 -->
        <resultMap id="BaseResultMap" type="com.yx.pojo.Repair">
                    <id column="id" property="id"/>
                    <result column="com_id" property="comId"/>
                    <result column="com_date" property="comDate"/>
                    <result column="handle_date" property="handleDate"/>
                    <result column="owner_id" property="ownerId"/>
                    <result column="status" property="status"/>
                    <result column="clr" property="clr"/>
                    <result column="remarks" property="remarks"/>
        </resultMap>

        <!-- 通用查询结果列 -->
        <sql id="Base_Column_List">
            id, com_id, com_date, handle_date, owner_id, status, clr, remarks
        </sql>
    <resultMap id="queryRepairAllMap" type="com.yx.pojo.Repair" extends="BaseResultMap">
        <association property="owner" javaType="com.yx.pojo.Owner">
            <id column="id" property="id"></id>
            <result column="username" property="username"></result>
        </association>
        <association property="type" javaType="com.yx.pojo.Repairtype">
            <id column="id" property="id"></id>
            <result column="name" property="name"></result>
        </association>
    </resultMap>

    <select id="queryRepairAll" parameterType="com.yx.pojo.Repair" resultMap="queryRepairAllMap">
        SELECT rep.*,owner.username,type.name
        FROM REPAIR rep
        LEFT JOIN repairtype TYPE ON type.id=rep.com_id
        LEFT JOIN OWNER ON owner.id =rep.owner_id
        <where>
            <if test="comId!=null">
                and com_id=#{comId}
            </if>
            <if test="status!=null">
                and rep.status=#{status}
            </if>
        </where>
    </select>
    
    <select id="queryCount" resultType="com.yx.pojo.Count">
        SELECT COUNT(info.id) AS counts,type.name
        FROM REPAIR info
        LEFT JOIN repairtype TYPE ON type.id = info.com_id
        GROUP BY
        info.com_id

    </select>
</mapper>